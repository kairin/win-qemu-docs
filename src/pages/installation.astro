---
import BaseLayout from '../layouts/BaseLayout.astro';
import CodeBlock from '../components/CodeBlock.astro';
---

<BaseLayout title="Installation" description="Complete QEMU/KVM installation guide for Windows 11 virtualization on Ubuntu 25.10">
  <!-- Header -->
  <section class="fade-in">
    <h2 class="font-display text-xl font-semibold text-base-content">Installation Guide</h2>
    <p class="mt-2 text-sm/6 text-base-content/70">
      Complete setup guide for QEMU/KVM Windows 11 virtualization on Ubuntu 25.10
    </p>
  </section>

  <!-- Prerequisites Alert -->
  <section class="mt-8 fade-in">
    <div class="rounded-xl bg-info/10 p-4 ring-1 ring-info/20">
      <h3 class="font-semibold text-info">Prerequisites</h3>
      <p class="mt-1 text-sm text-base-content/70">CPU with VT-x/AMD-V + IOMMU &bull; 16GB+ RAM &bull; Ubuntu 25.10 &bull; NVMe SSD</p>
    </div>
  </section>

  <!-- Step 1 -->
  <section class="mt-12 fade-in">
    <h3 class="font-display text-lg font-semibold text-base-content">Step 1: System Verification</h3>
    <p class="mt-2 text-sm/6 text-base-content/70">First, verify your system supports hardware virtualization:</p>

    <CodeBlock
      code={`# Check CPU virtualization support
grep -cE '(vmx|svm)' /proc/cpuinfo
# Output should be > 0 (number of CPU cores)

# Check IOMMU groups (required for GPU passthrough)
ls /sys/kernel/iommu_groups/
# Should show numbered directories (0, 1, 2, etc.)

# Check available RAM
free -h
# Minimum 16GB recommended`}
      lang="bash"
      filename="system-check.sh"
    />
  </section>

  <!-- Step 2 -->
  <section class="mt-12 fade-in">
    <h3 class="font-display text-lg font-semibold text-base-content">Step 2: Install QEMU/KVM Packages</h3>
    <p class="mt-2 text-sm/6 text-base-content/70">Install all required virtualization packages:</p>

    <CodeBlock
      code={`# Clone the repository
git clone https://github.com/kairin/win-qemu.git
cd win-qemu

# Run master installation script (requires sudo)
sudo ./scripts/install-master.sh

# This installs:
# - qemu-kvm (virtualization engine)
# - libvirt-daemon-system (management daemon)
# - virt-manager (GUI management)
# - ovmf (UEFI firmware)
# - swtpm (TPM 2.0 emulator)
# - And 5 more packages...`}
      lang="bash"
      filename="install.sh"
    />

    <div class="mt-4 rounded-xl bg-warning/10 p-4 ring-1 ring-warning/20">
      <p class="text-sm"><strong>Important:</strong> Reboot after installation for group membership changes to take effect.</p>
    </div>
  </section>

  <!-- Step 3 -->
  <section class="mt-12 fade-in">
    <h3 class="font-display text-lg font-semibold text-base-content">Step 3: Verify Installation</h3>

    <CodeBlock
      code={`# After reboot, verify installation
./scripts/03-verify-installation.sh

# Or manually check:
virsh --version           # Should show version (e.g., 10.0.0)
systemctl is-active libvirtd  # Should output: active
groups | grep libvirt     # Should show: libvirt kvm`}
      lang="bash"
    />
  </section>

  <!-- Step 4 -->
  <section class="mt-12 fade-in">
    <h3 class="font-display text-lg font-semibold text-base-content">Step 4: Download Required ISOs</h3>

    <div class="mt-4 grid grid-cols-1 gap-4 md:grid-cols-2">
      <div class="rounded-xl bg-base-200 p-4 ring-1 ring-base-content/5">
        <h4 class="font-semibold">Windows 11 ISO</h4>
        <p class="mt-1 text-sm text-base-content/70">Download from Microsoft official site</p>
        <span class="badge badge-primary badge-sm mt-2">~5.5 GB</span>
      </div>
      <div class="rounded-xl bg-base-200 p-4 ring-1 ring-base-content/5">
        <h4 class="font-semibold">VirtIO Drivers ISO</h4>
        <p class="mt-1 text-sm text-base-content/70">Required for disk and network performance</p>
        <span class="badge badge-secondary badge-sm mt-2">~753 MB</span>
      </div>
    </div>

    <CodeBlock
      code={`# Download VirtIO drivers
cd source-iso/
wget https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/virtio-win.iso

# Windows 11 ISO should be downloaded from:
# https://www.microsoft.com/software-download/windows11`}
      lang="bash"
    />
  </section>

  <!-- Step 5 -->
  <section class="mt-12 fade-in">
    <h3 class="font-display text-lg font-semibold text-base-content">Step 5: Create Windows 11 VM</h3>

    <CodeBlock
      code={`# Use the TUI menu
./start.sh

# Or create VM directly
./scripts/create-vm.sh

# VM Configuration:
# - Q35 chipset with UEFI/OVMF
# - TPM 2.0 (required for Windows 11)
# - VirtIO disk (for performance)
# - 8GB+ RAM allocation
# - 4+ CPU cores`}
      lang="bash"
    />
  </section>

  <!-- Next Steps -->
  <section class="mt-12 fade-in">
    <h3 class="font-display text-lg font-semibold text-base-content">Next Steps</h3>

    <div class="mt-4 grid grid-cols-1 gap-4 md:grid-cols-2">
      <a href={`${import.meta.env.BASE_URL}performance`} class="group rounded-xl bg-base-200 p-5 ring-1 ring-base-content/5 transition-all hover:ring-primary/30">
        <h4 class="font-semibold">Performance Optimization</h4>
        <p class="mt-1 text-sm text-base-content/70">Apply 14 Hyper-V enlightenments for 85-95% native performance</p>
        <span class="badge badge-primary badge-sm mt-2">Recommended</span>
      </a>
      <a href={`${import.meta.env.BASE_URL}security`} class="group rounded-xl bg-base-200 p-5 ring-1 ring-base-content/5 transition-all hover:ring-secondary/30">
        <h4 class="font-semibold">Security Hardening</h4>
        <p class="mt-1 text-sm text-base-content/70">Apply 60+ security hardening checklist items</p>
        <span class="badge badge-secondary badge-sm mt-2">Important</span>
      </a>
    </div>
  </section>
</BaseLayout>
