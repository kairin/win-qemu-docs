---
/**
 * StarField - Multi-layer animated constellation background
 * CSS-based animated star field with multiple constellation layers
 * Enhanced with bigger, brighter stars and more variations
 */
interface Props {
  class?: string;
}

const { class: className = '' } = Astro.props;

// Layer 1: Main constellation layer (original + enhanced)
const stars1 = [
  [4, 4, true, true, 1],
  [4, 44, true, false, 1.2],
  [36, 22, false, false, 1.5],
  [50, 146, true, true, 1],
  [64, 43, true, true, 1.2],
  [76, 30, true, false, 1],
  [101, 116, false, false, 2],
  [140, 36, true, false, 1.2],
  [149, 134, false, false, 1.8],
  [162, 74, true, false, 1],
  [171, 96, true, true, 1.2],
  [210, 56, true, true, 1],
  [235, 90, false, false, 2],
  [275, 82, true, true, 1.2],
  [306, 6, false, false, 1.8],
  [307, 64, true, true, 1],
  [380, 68, true, false, 1.2],
  [380, 108, true, true, 1],
  [391, 148, true, true, 1.2],
  [405, 18, true, false, 1],
  [412, 86, true, true, 1.2],
  [426, 210, true, true, 1],
  [427, 56, true, true, 1.2],
  [538, 138, false, false, 2],
  [563, 88, true, true, 1],
  [611, 154, true, true, 1.2],
  [637, 150, false, false, 1.8],
  [651, 146, true, false, 1],
  [682, 70, true, true, 1.2],
  [683, 128, false, false, 2],
  [781, 82, true, true, 1],
  [785, 158, true, false, 1.2],
  [832, 146, true, true, 1],
  [852, 89, false, false, 1.8],
  [879, 113, false, false, 2],
];

// Layer 2: Background layer (sparser, different positions)
const stars2 = [
  [120, 30, true, true, 0.8],
  [200, 120, true, false, 1],
  [280, 45, true, true, 0.8],
  [350, 160, true, false, 1],
  [450, 90, true, true, 0.8],
  [520, 180, true, false, 1],
  [620, 40, true, true, 0.8],
  [720, 130, true, false, 1],
  [820, 70, true, true, 0.8],
];

// Layer 3: Foreground accent layer (few bright stars)
const stars3 = [
  [180, 80, false, false, 2.5],
  [420, 140, false, false, 2.5],
  [660, 95, false, false, 2.5],
  [800, 160, false, false, 2.5],
];

// Constellation paths: arrays of [x, y] points - original 3 + 4 new patterns
const constellations1 = [
  [[247, 103], [261, 86], [307, 104], [357, 36]],
  [[586, 120], [516, 100], [491, 62], [440, 107], [477, 180], [516, 100]],
  [[733, 100], [803, 120], [879, 113], [823, 164], [803, 120]],
  // New constellations
  [[100, 60], [140, 40], [180, 55], [160, 90], [120, 85], [100, 60]],
  [[650, 50], [690, 35], [720, 60], [700, 80], [650, 50]],
];

// Layer 2 constellations (simpler)
const constellations2 = [
  [[200, 100], [250, 80], [300, 110]],
  [[550, 150], [600, 140], [640, 160]],
];

const uniqueId = `starfield-${Math.random().toString(36).slice(2, 11)}`;
---

<!-- Layer 1: Main layer (original position, enhanced) -->
<svg
  viewBox="0 0 881 211"
  fill="white"
  aria-hidden="true"
  class:list={[
    'pointer-events-none absolute w-[75rem] origin-top-right rotate-[30deg] overflow-visible opacity-80',
    className
  ]}
  data-astro-cid-starfield-layer1
>
  <defs>
    <filter id={`${uniqueId}-blur`}>
      <feGaussianBlur in="SourceGraphic" stdDeviation="0.5" />
    </filter>
    <filter id={`${uniqueId}-glow`}>
      <feGaussianBlur in="SourceGraphic" stdDeviation="1" result="blur" />
      <feMerge>
        <feMergeNode in="blur" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
  </defs>

  <!-- Constellation lines -->
  {constellations1.map((points, i) => (
    <path
      class="constellation-path"
      stroke="currentColor"
      stroke-opacity="0.35"
      stroke-width="0.5"
      stroke-dasharray="1"
      stroke-dashoffset="1"
      pathLength="1"
      fill="transparent"
      d={`M ${points.map(p => p.join(',')).join(' L ')}`}
      style={`animation-delay: ${(i + 1) * 1.2}s`}
    />
  ))}

  <!-- Stars -->
  {stars1.map(([x, y, dim, blur, size]) => (
    <g
      class="star-group"
      style={`animation-delay: ${Math.random() * 2}s`}
    >
      <circle
        cx={x}
        cy={y}
        r={size}
        class:list={[
          'star',
          dim ? 'star-dim' : 'star-bright'
        ]}
        filter={blur ? `url(#${uniqueId}-blur)` : (size > 1.5 ? `url(#${uniqueId}-glow)` : undefined)}
        style={`
          transform-origin: ${x / 16}rem ${y / 16}rem;
          animation-delay: ${Math.random() * 4}s;
        `}
      />
    </g>
  ))}
</svg>

<!-- Layer 2: Background layer (different angle, lower opacity) -->
<svg
  viewBox="0 0 881 211"
  fill="white"
  aria-hidden="true"
  class:list={[
    'pointer-events-none absolute w-[85rem] origin-top-right rotate-[15deg] overflow-visible opacity-40',
    className
  ]}
  style="top: -2rem; right: -6rem;"
  data-astro-cid-starfield-layer2
>
  <defs>
    <filter id={`${uniqueId}-blur2`}>
      <feGaussianBlur in="SourceGraphic" stdDeviation="0.8" />
    </filter>
  </defs>

  <!-- Constellation lines -->
  {constellations2.map((points, i) => (
    <path
      class="constellation-path constellation-bg"
      stroke="currentColor"
      stroke-opacity="0.2"
      stroke-width="0.3"
      stroke-dasharray="1"
      stroke-dashoffset="1"
      pathLength="1"
      fill="transparent"
      d={`M ${points.map(p => p.join(',')).join(' L ')}`}
      style={`animation-delay: ${(i + 1) * 2.5}s`}
    />
  ))}

  <!-- Stars -->
  {stars2.map(([x, y, dim, blur, size]) => (
    <g
      class="star-group star-group-bg"
      style={`animation-delay: ${Math.random() * 3 + 1}s`}
    >
      <circle
        cx={x}
        cy={y}
        r={size}
        class="star star-dim"
        filter={`url(#${uniqueId}-blur2)`}
        style={`
          transform-origin: ${x / 16}rem ${y / 16}rem;
          animation-delay: ${Math.random() * 5}s;
        `}
      />
    </g>
  ))}
</svg>

<!-- Layer 3: Foreground accent layer (sparse bright stars) -->
<svg
  viewBox="0 0 881 211"
  fill="white"
  aria-hidden="true"
  class:list={[
    'pointer-events-none absolute w-[70rem] origin-top-right rotate-[45deg] overflow-visible opacity-90',
    className
  ]}
  style="top: 1rem; right: -3rem;"
  data-astro-cid-starfield-layer3
>
  <defs>
    <filter id={`${uniqueId}-glow3`}>
      <feGaussianBlur in="SourceGraphic" stdDeviation="1.5" result="blur" />
      <feMerge>
        <feMergeNode in="blur" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
  </defs>

  <!-- Bright accent stars -->
  {stars3.map(([x, y, dim, blur, size]) => (
    <g
      class="star-group star-group-accent"
      style={`animation-delay: ${Math.random() * 2 + 0.5}s`}
    >
      <circle
        cx={x}
        cy={y}
        r={size}
        class="star star-accent"
        filter={`url(#${uniqueId}-glow3)`}
        style={`
          transform-origin: ${x / 16}rem ${y / 16}rem;
          animation-delay: ${Math.random() * 3}s;
        `}
      />
    </g>
  ))}
</svg>

<style>
  .star-group {
    opacity: 0;
    animation: fadeInStar 3s ease-out forwards;
  }

  .star-group-bg {
    animation: fadeInStar 4s ease-out forwards;
  }

  .star-group-accent {
    animation: fadeInStar 2s ease-out forwards;
  }

  .star {
    animation: twinkle 4s ease-in-out infinite;
  }

  .star-dim {
    opacity: 0.4;
    transform: scale(1);
  }

  .star-bright {
    opacity: 1;
    transform: scale(1.5);
  }

  .star-accent {
    opacity: 1;
    transform: scale(1.8);
    animation: twinkleAccent 3s ease-in-out infinite;
  }

  .constellation-path {
    animation: drawConstellation 5s ease-out forwards;
    visibility: hidden;
  }

  .constellation-bg {
    animation: drawConstellation 7s ease-out forwards;
  }

  @keyframes fadeInStar {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes twinkle {
    0%, 100% {
      opacity: inherit;
      transform: inherit;
    }
    50% {
      opacity: 0.7;
      transform: scale(1.3);
    }
  }

  @keyframes twinkleAccent {
    0%, 100% {
      opacity: 1;
      transform: scale(1.8);
    }
    50% {
      opacity: 0.8;
      transform: scale(2.2);
    }
  }

  @keyframes drawConstellation {
    0% {
      stroke-dashoffset: 1;
      visibility: visible;
    }
    100% {
      stroke-dashoffset: 0;
      visibility: visible;
    }
  }
</style>
